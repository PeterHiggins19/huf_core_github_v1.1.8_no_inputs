
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Normalization-invariant audit layer for hierarchical mixtures (regimes/tenants/sources)">
      
      
        <meta name="author" content="Peter Higgins">
      
      
        <link rel="canonical" href="https://peterhiggins19.github.io/huf_core/partners/case_studies/planck_lfi_70ghz/">
      
      
        <link rel="prev" href="../markham_worked_example/">
      
      
        <link rel="next" href="../../../jupyter_demos/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Planck LFI 70 GHz - Higgins Unity Framework (HUF)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#planck-lfi-70-ghz-reference-run" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Higgins Unity Framework (HUF)" class="md-header__button md-logo" aria-label="Higgins Unity Framework (HUF)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Higgins Unity Framework (HUF)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Planck LFI 70 GHz
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/PeterHiggins19/huf_core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    PeterHiggins19/huf_core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Higgins Unity Framework (HUF)" class="md-nav__button md-logo" aria-label="Higgins Unity Framework (HUF)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Higgins Unity Framework (HUF)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PeterHiggins19/huf_core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    PeterHiggins19/huf_core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../learning_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Learning path
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick run
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    HUF Books
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    HUF Books
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../handbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HUF Handbook (v1.3.0)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../huf_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HUF Reference (v1.3.0)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ethics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ethics & disclosure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Start here
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start here
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../running_examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running examples (Windows/macOS/Linux)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows_powershell_vs_python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PowerShell vs Python (Windows-safe)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../start_here/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get_started_zero_github/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zero GitHub knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../get_started_readme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Get started (README-style)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data_sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data sources & fetching
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../science/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Science
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Science
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../civic/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Civic
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Civic
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Cases
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Planck LFI 70 GHz
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Planck LFI 70 GHz
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-page-is" class="md-nav__link">
    <span class="md-ellipsis">
      
        What this page is
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why it matters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-see" class="md-nav__link">
    <span class="md-ellipsis">
      
        What you’ll see
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#artifacts-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Artifacts / outputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artifacts / outputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run the example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-to-expect" class="md-nav__link">
    <span class="md-ellipsis">
      
        What to expect
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpretation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interpretation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-details-converted-from-html" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reference details (converted from HTML)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-the-planck-cmb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why the Planck CMB?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-Data Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Data Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sky-pixels-v-h" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sky pixels v ∈ ℋ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-frequency-channels" class="md-nav__link">
    <span class="md-ellipsis">
      
        7 frequency channels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Σρ = 1.0
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibration-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calibration residuals
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huf-for-frequency-regimes" class="md-nav__link">
    <span class="md-ellipsis">
      
        HUF for Frequency Regimes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HUF for Frequency Regimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch-1-1h-e_v-e_vt-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        C(ℋ) = 1 − (1/|ℋ|) Σ‖e_v' − e_v^(t-1)‖₂
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f_r-in-j_r" class="md-nav__link">
    <span class="md-ellipsis">
      
        φ · F_r in J_r
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cosine-distance-trigger" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cosine distance trigger
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-step-calibration-drift-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        10-Step Calibration Drift Run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-fitness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Fitness
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-reference-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Python Reference Run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Reference Run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-the-huf-repo" class="md-nav__link">
    <span class="md-ellipsis">
      
        From the HUF repo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esa-public-archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        ESA Public Archive
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-log-per-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit log per step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../markham_worked_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    City of Markham
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traffic_phase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Traffic phase anomaly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Adapters
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Adapters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../vector_db_coherence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector DB coherence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../vector_db_coherence_one_pager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector DB coherence (one-page brief)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Research
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Research
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../huf_math_form_and_function/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mathematical form and function
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../theory_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Theory notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../long_tail_accounting_lens/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Long tail (accounting lens)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../The_Higgins_Unity_Framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HUF overview (legacy notes)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs_inventory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docs inventory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference_manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli_huf_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI command lists + terminology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../repo_hygiene/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repo hygiene (clean commits)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gui_quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GUI quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../github_for_beginners/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub for beginners
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Partners
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Partners
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12_2" >
        
          
          <label class="md-nav__link" for="__nav_12_2" id="__nav_12_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/weaviate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weaviate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/qdrant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Qdrant
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pinecone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pinecone
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/langchain_llamaindex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangChain & LlamaIndex
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/evaluation_platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation platforms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/public_sector_accounting_lens/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Public sector accounting lens
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/science_planck_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Science validation: Planck
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Case studies
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12_3" id="__nav_12_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_12_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Case studies
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traffic_phase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Traffic phase anomaly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../markham_worked_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    City of Markham
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Planck LFI 70 GHz
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Planck LFI 70 GHz
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-page-is" class="md-nav__link">
    <span class="md-ellipsis">
      
        What this page is
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why it matters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-see" class="md-nav__link">
    <span class="md-ellipsis">
      
        What you’ll see
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#artifacts-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Artifacts / outputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artifacts / outputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run the example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-to-expect" class="md-nav__link">
    <span class="md-ellipsis">
      
        What to expect
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpretation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interpretation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-details-converted-from-html" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reference details (converted from HTML)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-the-planck-cmb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why the Planck CMB?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-Data Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Data Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sky-pixels-v-h" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sky pixels v ∈ ℋ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-frequency-channels" class="md-nav__link">
    <span class="md-ellipsis">
      
        7 frequency channels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Σρ = 1.0
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibration-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calibration residuals
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huf-for-frequency-regimes" class="md-nav__link">
    <span class="md-ellipsis">
      
        HUF for Frequency Regimes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HUF for Frequency Regimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch-1-1h-e_v-e_vt-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        C(ℋ) = 1 − (1/|ℋ|) Σ‖e_v' − e_v^(t-1)‖₂
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f_r-in-j_r" class="md-nav__link">
    <span class="md-ellipsis">
      
        φ · F_r in J_r
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cosine-distance-trigger" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cosine distance trigger
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-step-calibration-drift-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        10-Step Calibration Drift Run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-fitness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Fitness
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-reference-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Python Reference Run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Reference Run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-the-huf-repo" class="md-nav__link">
    <span class="md-ellipsis">
      
        From the HUF repo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esa-public-archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        ESA Public Archive
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-log-per-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit log per step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Optional
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Optional
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../jupyter_demos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jupyter demos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-page-is" class="md-nav__link">
    <span class="md-ellipsis">
      
        What this page is
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why it matters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-see" class="md-nav__link">
    <span class="md-ellipsis">
      
        What you’ll see
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#artifacts-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Artifacts / outputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artifacts / outputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run the example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-to-expect" class="md-nav__link">
    <span class="md-ellipsis">
      
        What to expect
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpretation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interpretation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-details-converted-from-html" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reference details (converted from HTML)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-the-planck-cmb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why the Planck CMB?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-Data Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Data Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sky-pixels-v-h" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sky pixels v ∈ ℋ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-frequency-channels" class="md-nav__link">
    <span class="md-ellipsis">
      
        7 frequency channels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Σρ = 1.0
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibration-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calibration residuals
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#huf-for-frequency-regimes" class="md-nav__link">
    <span class="md-ellipsis">
      
        HUF for Frequency Regimes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HUF for Frequency Regimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch-1-1h-e_v-e_vt-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        C(ℋ) = 1 − (1/|ℋ|) Σ‖e_v' − e_v^(t-1)‖₂
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#f_r-in-j_r" class="md-nav__link">
    <span class="md-ellipsis">
      
        φ · F_r in J_r
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cosine-distance-trigger" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cosine distance trigger
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-step-calibration-drift-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        10-Step Calibration Drift Run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-fitness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Fitness
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-reference-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Python Reference Run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Reference Run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-the-huf-repo" class="md-nav__link">
    <span class="md-ellipsis">
      
        From the HUF repo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esa-public-archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        ESA Public Archive
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-log-per-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit log per step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    Partners
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Case studies
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="planck-lfi-70-ghz-reference-run">Planck LFI 70 GHz reference run<a class="headerlink" href="#planck-lfi-70-ghz-reference-run" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Applying HUF normalization to ESA's Planck satellite frequency maps — treating LFI channels as hierarchical regimes
    and validating coherence across 1,000 sky temperature measurements. A real-data-oriented example (with a synthetic stub) showing how HUF can be applied to frequency-regime data without claiming new cosmological results.</p>
</blockquote>
<div class="admonition note">
<p class="admonition-title">Ethics &amp; authorship</p>
<p>This page was drafted with AI assistance as an editing and structuring tool. The author reviewed and curated all formal claims; any numerical results shown here are either reproduced by code in this repository or explicitly labeled as illustrative.</p>
</div>
<h2 id="what-this-page-is">What this page is<a class="headerlink" href="#what-this-page-is" title="Permanent link">&para;</a></h2>
<p>A worked example showing how to encode a real operational hierarchy as HUF regimes, run regime-conditioned normalization, and read the resulting audit trace.</p>
<h2 id="why-it-matters">Why it matters<a class="headerlink" href="#why-it-matters" title="Permanent link">&para;</a></h2>
<ul>
<li>Case studies are where the counterintuitive pieces <em>click</em>: nested normalization, regime penalties, and the difference between <strong>mass</strong> vs <strong>share</strong>.</li>
<li>You can swap in your own data by matching the schema.</li>
</ul>
<h2 id="what-youll-see">What you’ll see<a class="headerlink" href="#what-youll-see" title="Permanent link">&para;</a></h2>
<ul>
<li>Why the Planck CMB?</li>
<li>Real-Data Structure</li>
<li>HUF for Frequency Regimes</li>
<li>10-Step Calibration Drift Run</li>
<li>Architecture Fitness</li>
<li>Python Reference Run</li>
</ul>
<h2 id="artifacts-outputs">Artifacts / outputs<a class="headerlink" href="#artifacts-outputs" title="Permanent link">&para;</a></h2>
<ul>
<li>A runnable Python script (single file).</li>
<li>JSONL trace lines per step.</li>
</ul>
<h3 id="key-tables">Key tables<a class="headerlink" href="#key-tables" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Event</th>
<th>α* (70 GHz)</th>
<th>α* (353 GHz)</th>
<th>ρ_post (peak pixel)</th>
<th>C_local (70 GHz)</th>
<th>C(ℋ) global</th>
<th>kb_eroded</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>0.0112</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>1</td>
<td>Calibration noise</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0109</td>
<td>0.961</td>
<td>0.962</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Calibration noise</td>
<td>0.57</td>
<td>0.43</td>
<td>0.0108</td>
<td>0.959</td>
<td>0.960</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Bandpass shift</td>
<td>0.55</td>
<td>0.43</td>
<td>0.0106</td>
<td>0.955</td>
<td>0.957</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>Bandpass shift</td>
<td>0.54</td>
<td>0.44</td>
<td>0.0105</td>
<td>0.951</td>
<td>0.953</td>
<td>0</td>
</tr>
<tr>
<td>5</td>
<td>30 GHz flare ↑</td>
<td>0.60</td>
<td>0.36</td>
<td>0.0103</td>
<td>0.948</td>
<td>0.947</td>
<td>2</td>
</tr>
<tr>
<td>6</td>
<td>Post-flare adapt</td>
<td>0.61</td>
<td>0.38</td>
<td>0.0104</td>
<td>0.953</td>
<td>0.952</td>
<td>0</td>
</tr>
<tr>
<td>7</td>
<td>Steady state</td>
<td>0.59</td>
<td>0.41</td>
<td>0.0105</td>
<td>0.957</td>
<td>0.958</td>
<td>0</td>
</tr>
<tr>
<td>8</td>
<td>Steady state</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0106</td>
<td>0.960</td>
<td>0.962</td>
<td>0</td>
</tr>
<tr>
<td>9</td>
<td>Steady state</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0107</td>
<td>0.963</td>
<td>0.967</td>
<td>0</td>
</tr>
<tr>
<td>10</td>
<td>Final state</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0108</td>
<td>0.965</td>
<td>0.968</td>
<td>0</td>
</tr>
</tbody>
</table>
<h2 id="run-the-example">Run the example<a class="headerlink" href="#run-the-example" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># huf_planck_70ghz.py — HUF reference run: Planck LFI 70 GHz</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nn">numpy</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">as</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nn">np</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kn">import</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nn">json</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># ─── 1. Synthetic CMB data (replace with healpy.read_map for real Planck data) ────</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">rng</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a> <span class="o">=</span> 
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="p">(</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="mi">42</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="n">n_pixels</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a> <span class="o">=</span> 
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="mi">1000</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="n">T_CMB</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a> <span class="o">=</span> 
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="mf">2.725</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="c1"># K, CMB average</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="n">sigma_CMB</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a> <span class="o">=</span> 
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="mf">0.0001</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="p">)</span>       
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="c1"># K, ESA 2018 variance</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="c1"># 7 frequency channels: 30, 44, 70, 100, 143, 217, 353 GHz</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="n">channels</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="mi">30</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="p">,</span> 
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="mi">44</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="p">,</span> 
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="mi">70</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="p">,</span> 
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="mi">100</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="p">,</span> 
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="mi">143</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="p">,</span> 
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="mi">217</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="p">,</span> 
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="mi">353</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="p">]</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="n">F_r</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="mi">30</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="p">:</span> 
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="mf">0.30</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="p">,</span> 
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="mi">44</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="p">:</span> 
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="mf">0.18</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="p">,</span> 
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="mi">70</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="p">:</span> 
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="mf">0.09</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="p">,</span> 
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="mi">100</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="p">:</span> 
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="mf">0.05</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="mi">143</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="p">:</span> 
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="mf">0.04</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="p">,</span> 
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="mi">217</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="p">:</span> 
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="mf">0.12</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="p">,</span> 
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="mi">353</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="p">:</span> 
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="mf">0.45</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="p">}</span>  
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="c1"># foreground fractions</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="c1"># Base temperature maps per channel (calibration noise added per step)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="n">T_maps</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="n">ch</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="p">:</span> 
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="n">rng</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="o">.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a><span class="n">normal</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="p">(</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="n">T_CMB</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a><span class="p">,</span> 
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="n">sigma_CMB</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="p">,</span> 
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a><span class="n">n_pixels</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="p">)</span> <span class="o">+</span> 
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="n">F_r</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="p">[</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a><span class="n">ch</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="p">]</span> <span class="o">*</span> 
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="mf">0.01</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="k">for</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a><span class="n">ch</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="ow">in</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a><span class="n">channels</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="p">}</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="c1"># ─── 2. HUF normalization operator ────────────────────────────────────────────</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a><span class="k">def</span>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="nf">huf_normalize</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a><span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="n">e_v</span>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a><span class="p">,</span> 
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="n">mu_p</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="p">,</span> 
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="n">sig_p</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="p">,</span> 
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a><span class="n">w_vp</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a><span class="p">):</span>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="k">return</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a> <span class="p">((</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="n">e_v</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a> <span class="o">-</span> 
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="n">mu_p</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="p">)</span> <span class="o">/</span> 
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="n">sig_p</span>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="p">)</span> <span class="o">*</span> 
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="n">w_vp</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a><span class="k">def</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a><span class="nf">coherence</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="n">e_curr</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a><span class="p">,</span> 
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="n">e_prev</span>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a><span class="k">return</span>
<a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="mf">1.0</span>
<a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a> <span class="o">-</span> 
<a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a><span class="n">np</span><span class="o">.</span><span class="n">mean</span>
<a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a><span class="p">(</span>
<a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a><span class="n">np</span><span class="o">.</span><span class="n">abs</span>
<a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="n">e_curr</span>
<a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a> <span class="o">-</span> 
<a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a><span class="n">e_prev</span>
<a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a><span class="p">))</span>
<a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a><span class="k">def</span>
<a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a><span class="nf">objective_J</span>
<a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a><span class="p">(</span>
<a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a><span class="n">alpha</span>
<a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a><span class="p">,</span> 
<a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a><span class="n">C_r</span>
<a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a><span class="p">,</span> 
<a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a><span class="n">rho_local</span>
<a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a><span class="p">,</span> 
<a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a><span class="n">F</span>
<a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a><span class="p">,</span> 
<a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a><span class="n">lam</span>
<a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a><span class="o">=</span>
<a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a><span class="mf">0.1</span>
<a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a><span class="p">,</span> 
<a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a><span class="n">phi</span>
<a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a><span class="o">=</span>
<a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a><span class="mf">0.08</span>
<a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a><span class="p">):</span>
<a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a><span class="k">return</span>
<a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a> <span class="p">(</span>
<a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a><span class="mi">1</span>
<a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a> <span class="o">-</span> 
<a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a><span class="n">C_r</span>
<a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a><span class="p">)</span> <span class="o">+</span> 
<a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a><span class="n">lam</span>
<a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a> <span class="o">*</span> 
<a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a><span class="n">np</span><span class="o">.</span><span class="n">var</span>
<a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a><span class="n">rho_local</span>
<a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a><span class="p">)</span> <span class="o">+</span> 
<a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a><span class="n">phi</span>
<a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a> <span class="o">*</span> 
<a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a><span class="n">F</span>
<a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a><span class="c1"># ─── 3. 10-step adaptive simulation ───────────────────────────────────────────</span>
<a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a><span class="n">results</span>
<a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a><span class="n">alpha_prev</span>
<a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a><span class="n">ch</span>
<a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a><span class="p">:</span> 
<a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a><span class="mf">0.5</span>
<a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a><span class="k">for</span>
<a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a><span class="n">ch</span>
<a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a><span class="ow">in</span>
<a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a><span class="n">channels</span>
<a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a><span class="p">}</span>
<a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a><span class="n">e_prev</span>
<a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a><span class="n">ch</span>
<a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a><span class="p">:</span> 
<a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a><span class="n">T_maps</span>
<a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a><span class="p">[</span>
<a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a><span class="n">ch</span>
<a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a><span class="p">]</span><span class="o">.</span>
<a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a><span class="n">copy</span>
<a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a><span class="p">()</span> 
<a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a><span class="k">for</span>
<a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a><span class="n">ch</span>
<a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a><span class="ow">in</span>
<a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a><span class="n">channels</span>
<a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a><span class="p">}</span>
<a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a><span class="k">for</span>
<a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a><span class="n">step</span>
<a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a><span class="ow">in</span>
<a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a><span class="nb">range</span>
<a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a><span class="p">(</span>
<a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a><span class="mi">1</span>
<a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a><span class="p">,</span> 
<a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a><span class="mi">11</span>
<a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a><span class="p">):</span>
<a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a><span class="c1"># Step 5: foreground flare at 30 GHz</span>
<a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a><span class="k">if</span>
<a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a><span class="n">step</span>
<a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a> <span class="o">==</span> 
<a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a><span class="mi">5</span>
<a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a><span class="p">:</span> 
<a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a><span class="n">F_r</span>
<a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a><span class="p">[</span>
<a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a><span class="mi">30</span>
<a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a><span class="mf">0.45</span>
<a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a><span class="k">else</span>
<a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a><span class="p">:</span> 
<a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a><span class="n">F_r</span>
<a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a><span class="p">[</span>
<a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a><span class="mi">30</span>
<a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a><span class="mf">0.30</span>
<a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a><span class="n">noise</span>
<a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a> <span class="o">=</span> 
<a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a><span class="n">rng</span>
<a id="__codelineno-0-315" name="__codelineno-0-315" href="#__codelineno-0-315"></a><span class="o">.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316" href="#__codelineno-0-316"></a><span class="n">normal</span>
<a id="__codelineno-0-317" name="__codelineno-0-317" href="#__codelineno-0-317"></a><span class="p">(</span>
<a id="__codelineno-0-318" name="__codelineno-0-318" href="#__codelineno-0-318"></a><span class="mi">0</span>
<a id="__codelineno-0-319" name="__codelineno-0-319" href="#__codelineno-0-319"></a><span class="p">,</span> 
<a id="__codelineno-0-320" name="__codelineno-0-320" href="#__codelineno-0-320"></a><span class="mf">0.008</span>
<a id="__codelineno-0-321" name="__codelineno-0-321" href="#__codelineno-0-321"></a><span class="p">,</span> 
<a id="__codelineno-0-322" name="__codelineno-0-322" href="#__codelineno-0-322"></a><span class="n">n_pixels</span>
<a id="__codelineno-0-323" name="__codelineno-0-323" href="#__codelineno-0-323"></a><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324" href="#__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325" href="#__codelineno-0-325"></a><span class="n">alphas_new</span>
<a id="__codelineno-0-326" name="__codelineno-0-326" href="#__codelineno-0-326"></a> <span class="o">=</span> <span class="p">{};</span> 
<a id="__codelineno-0-327" name="__codelineno-0-327" href="#__codelineno-0-327"></a><span class="n">C_locals</span>
<a id="__codelineno-0-328" name="__codelineno-0-328" href="#__codelineno-0-328"></a> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-329" name="__codelineno-0-329" href="#__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330" href="#__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331" href="#__codelineno-0-331"></a><span class="k">for</span>
<a id="__codelineno-0-332" name="__codelineno-0-332" href="#__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333" href="#__codelineno-0-333"></a><span class="n">ch</span>
<a id="__codelineno-0-334" name="__codelineno-0-334" href="#__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335" href="#__codelineno-0-335"></a><span class="ow">in</span>
<a id="__codelineno-0-336" name="__codelineno-0-336" href="#__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337" href="#__codelineno-0-337"></a><span class="n">channels</span>
<a id="__codelineno-0-338" name="__codelineno-0-338" href="#__codelineno-0-338"></a><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339" href="#__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340" href="#__codelineno-0-340"></a><span class="n">e_curr</span>
<a id="__codelineno-0-341" name="__codelineno-0-341" href="#__codelineno-0-341"></a> <span class="o">=</span> 
<a id="__codelineno-0-342" name="__codelineno-0-342" href="#__codelineno-0-342"></a><span class="n">T_maps</span>
<a id="__codelineno-0-343" name="__codelineno-0-343" href="#__codelineno-0-343"></a><span class="p">[</span>
<a id="__codelineno-0-344" name="__codelineno-0-344" href="#__codelineno-0-344"></a><span class="n">ch</span>
<a id="__codelineno-0-345" name="__codelineno-0-345" href="#__codelineno-0-345"></a><span class="p">]</span> <span class="o">+</span> 
<a id="__codelineno-0-346" name="__codelineno-0-346" href="#__codelineno-0-346"></a><span class="n">noise</span>
<a id="__codelineno-0-347" name="__codelineno-0-347" href="#__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348" href="#__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349" href="#__codelineno-0-349"></a><span class="n">mu_p</span>
<a id="__codelineno-0-350" name="__codelineno-0-350" href="#__codelineno-0-350"></a><span class="p">,</span> 
<a id="__codelineno-0-351" name="__codelineno-0-351" href="#__codelineno-0-351"></a><span class="n">sig_p</span>
<a id="__codelineno-0-352" name="__codelineno-0-352" href="#__codelineno-0-352"></a> <span class="o">=</span> 
<a id="__codelineno-0-353" name="__codelineno-0-353" href="#__codelineno-0-353"></a><span class="n">e_curr</span>
<a id="__codelineno-0-354" name="__codelineno-0-354" href="#__codelineno-0-354"></a><span class="o">.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355" href="#__codelineno-0-355"></a><span class="n">mean</span>
<a id="__codelineno-0-356" name="__codelineno-0-356" href="#__codelineno-0-356"></a><span class="p">(),</span> 
<a id="__codelineno-0-357" name="__codelineno-0-357" href="#__codelineno-0-357"></a><span class="n">e_curr</span>
<a id="__codelineno-0-358" name="__codelineno-0-358" href="#__codelineno-0-358"></a><span class="o">.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359" href="#__codelineno-0-359"></a><span class="n">std</span>
<a id="__codelineno-0-360" name="__codelineno-0-360" href="#__codelineno-0-360"></a><span class="p">()</span> <span class="o">+</span> 
<a id="__codelineno-0-361" name="__codelineno-0-361" href="#__codelineno-0-361"></a><span class="mf">1e-8</span>
<a id="__codelineno-0-362" name="__codelineno-0-362" href="#__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363" href="#__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364" href="#__codelineno-0-364"></a><span class="n">e_norm</span>
<a id="__codelineno-0-365" name="__codelineno-0-365" href="#__codelineno-0-365"></a> <span class="o">=</span> 
<a id="__codelineno-0-366" name="__codelineno-0-366" href="#__codelineno-0-366"></a><span class="n">huf_normalize</span>
<a id="__codelineno-0-367" name="__codelineno-0-367" href="#__codelineno-0-367"></a><span class="p">(</span>
<a id="__codelineno-0-368" name="__codelineno-0-368" href="#__codelineno-0-368"></a><span class="n">e_curr</span>
<a id="__codelineno-0-369" name="__codelineno-0-369" href="#__codelineno-0-369"></a><span class="p">,</span> 
<a id="__codelineno-0-370" name="__codelineno-0-370" href="#__codelineno-0-370"></a><span class="n">mu_p</span>
<a id="__codelineno-0-371" name="__codelineno-0-371" href="#__codelineno-0-371"></a><span class="p">,</span> 
<a id="__codelineno-0-372" name="__codelineno-0-372" href="#__codelineno-0-372"></a><span class="n">sig_p</span>
<a id="__codelineno-0-373" name="__codelineno-0-373" href="#__codelineno-0-373"></a><span class="p">,</span> 
<a id="__codelineno-0-374" name="__codelineno-0-374" href="#__codelineno-0-374"></a><span class="mf">1.0</span>
<a id="__codelineno-0-375" name="__codelineno-0-375" href="#__codelineno-0-375"></a><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376" href="#__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377" href="#__codelineno-0-377"></a><span class="n">C_r</span>
<a id="__codelineno-0-378" name="__codelineno-0-378" href="#__codelineno-0-378"></a> <span class="o">=</span> 
<a id="__codelineno-0-379" name="__codelineno-0-379" href="#__codelineno-0-379"></a><span class="n">coherence</span>
<a id="__codelineno-0-380" name="__codelineno-0-380" href="#__codelineno-0-380"></a><span class="p">(</span>
<a id="__codelineno-0-381" name="__codelineno-0-381" href="#__codelineno-0-381"></a><span class="n">e_norm</span>
<a id="__codelineno-0-382" name="__codelineno-0-382" href="#__codelineno-0-382"></a><span class="p">,</span> 
<a id="__codelineno-0-383" name="__codelineno-0-383" href="#__codelineno-0-383"></a><span class="n">e_prev</span>
<a id="__codelineno-0-384" name="__codelineno-0-384" href="#__codelineno-0-384"></a><span class="p">[</span>
<a id="__codelineno-0-385" name="__codelineno-0-385" href="#__codelineno-0-385"></a><span class="n">ch</span>
<a id="__codelineno-0-386" name="__codelineno-0-386" href="#__codelineno-0-386"></a><span class="p">])</span>
<a id="__codelineno-0-387" name="__codelineno-0-387" href="#__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388" href="#__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389" href="#__codelineno-0-389"></a><span class="c1"># Scan α in [0,1], minimise J_r</span>
<a id="__codelineno-0-390" name="__codelineno-0-390" href="#__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391" href="#__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392" href="#__codelineno-0-392"></a><span class="n">best_a</span>
<a id="__codelineno-0-393" name="__codelineno-0-393" href="#__codelineno-0-393"></a><span class="p">,</span> 
<a id="__codelineno-0-394" name="__codelineno-0-394" href="#__codelineno-0-394"></a><span class="n">best_J</span>
<a id="__codelineno-0-395" name="__codelineno-0-395" href="#__codelineno-0-395"></a> <span class="o">=</span> 
<a id="__codelineno-0-396" name="__codelineno-0-396" href="#__codelineno-0-396"></a><span class="mf">0.5</span>
<a id="__codelineno-0-397" name="__codelineno-0-397" href="#__codelineno-0-397"></a><span class="p">,</span> 
<a id="__codelineno-0-398" name="__codelineno-0-398" href="#__codelineno-0-398"></a><span class="nb">float</span>
<a id="__codelineno-0-399" name="__codelineno-0-399" href="#__codelineno-0-399"></a><span class="p">(</span>
<a id="__codelineno-0-400" name="__codelineno-0-400" href="#__codelineno-0-400"></a><span class="s1">&#39;inf&#39;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401" href="#__codelineno-0-401"></a><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402" href="#__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403" href="#__codelineno-0-403"></a><span class="k">for</span>
<a id="__codelineno-0-404" name="__codelineno-0-404" href="#__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405" href="#__codelineno-0-405"></a><span class="n">a</span>
<a id="__codelineno-0-406" name="__codelineno-0-406" href="#__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407" href="#__codelineno-0-407"></a><span class="ow">in</span>
<a id="__codelineno-0-408" name="__codelineno-0-408" href="#__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409" href="#__codelineno-0-409"></a><span class="n">np</span><span class="o">.</span><span class="n">linspace</span>
<a id="__codelineno-0-410" name="__codelineno-0-410" href="#__codelineno-0-410"></a><span class="p">(</span>
<a id="__codelineno-0-411" name="__codelineno-0-411" href="#__codelineno-0-411"></a><span class="mf">0.0</span>
<a id="__codelineno-0-412" name="__codelineno-0-412" href="#__codelineno-0-412"></a><span class="p">,</span> 
<a id="__codelineno-0-413" name="__codelineno-0-413" href="#__codelineno-0-413"></a><span class="mf">1.0</span>
<a id="__codelineno-0-414" name="__codelineno-0-414" href="#__codelineno-0-414"></a><span class="p">,</span> 
<a id="__codelineno-0-415" name="__codelineno-0-415" href="#__codelineno-0-415"></a><span class="mi">21</span>
<a id="__codelineno-0-416" name="__codelineno-0-416" href="#__codelineno-0-416"></a><span class="p">):</span>
<a id="__codelineno-0-417" name="__codelineno-0-417" href="#__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418" href="#__codelineno-0-418"></a><span class="n">e_cand</span>
<a id="__codelineno-0-419" name="__codelineno-0-419" href="#__codelineno-0-419"></a> <span class="o">=</span> 
<a id="__codelineno-0-420" name="__codelineno-0-420" href="#__codelineno-0-420"></a><span class="n">e_norm</span>
<a id="__codelineno-0-421" name="__codelineno-0-421" href="#__codelineno-0-421"></a> <span class="o">+</span> 
<a id="__codelineno-0-422" name="__codelineno-0-422" href="#__codelineno-0-422"></a><span class="n">a</span>
<a id="__codelineno-0-423" name="__codelineno-0-423" href="#__codelineno-0-423"></a> <span class="o">*</span> 
<a id="__codelineno-0-424" name="__codelineno-0-424" href="#__codelineno-0-424"></a><span class="n">e_prev</span>
<a id="__codelineno-0-425" name="__codelineno-0-425" href="#__codelineno-0-425"></a><span class="p">[</span>
<a id="__codelineno-0-426" name="__codelineno-0-426" href="#__codelineno-0-426"></a><span class="n">ch</span>
<a id="__codelineno-0-427" name="__codelineno-0-427" href="#__codelineno-0-427"></a><span class="p">]</span>
<a id="__codelineno-0-428" name="__codelineno-0-428" href="#__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429" href="#__codelineno-0-429"></a><span class="n">rho</span>
<a id="__codelineno-0-430" name="__codelineno-0-430" href="#__codelineno-0-430"></a> <span class="o">=</span> 
<a id="__codelineno-0-431" name="__codelineno-0-431" href="#__codelineno-0-431"></a><span class="n">np</span><span class="o">.</span><span class="n">exp</span>
<a id="__codelineno-0-432" name="__codelineno-0-432" href="#__codelineno-0-432"></a><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433" href="#__codelineno-0-433"></a><span class="n">e_cand</span>
<a id="__codelineno-0-434" name="__codelineno-0-434" href="#__codelineno-0-434"></a><span class="p">);</span> 
<a id="__codelineno-0-435" name="__codelineno-0-435" href="#__codelineno-0-435"></a><span class="n">rho</span>
<a id="__codelineno-0-436" name="__codelineno-0-436" href="#__codelineno-0-436"></a> <span class="o">/=</span> 
<a id="__codelineno-0-437" name="__codelineno-0-437" href="#__codelineno-0-437"></a><span class="n">rho</span>
<a id="__codelineno-0-438" name="__codelineno-0-438" href="#__codelineno-0-438"></a><span class="o">.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439" href="#__codelineno-0-439"></a><span class="nb">sum</span>
<a id="__codelineno-0-440" name="__codelineno-0-440" href="#__codelineno-0-440"></a><span class="p">()</span>
<a id="__codelineno-0-441" name="__codelineno-0-441" href="#__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442" href="#__codelineno-0-442"></a><span class="n">J</span>
<a id="__codelineno-0-443" name="__codelineno-0-443" href="#__codelineno-0-443"></a> <span class="o">=</span> 
<a id="__codelineno-0-444" name="__codelineno-0-444" href="#__codelineno-0-444"></a><span class="n">objective_J</span>
<a id="__codelineno-0-445" name="__codelineno-0-445" href="#__codelineno-0-445"></a><span class="p">(</span>
<a id="__codelineno-0-446" name="__codelineno-0-446" href="#__codelineno-0-446"></a><span class="n">a</span>
<a id="__codelineno-0-447" name="__codelineno-0-447" href="#__codelineno-0-447"></a><span class="p">,</span> 
<a id="__codelineno-0-448" name="__codelineno-0-448" href="#__codelineno-0-448"></a><span class="n">C_r</span>
<a id="__codelineno-0-449" name="__codelineno-0-449" href="#__codelineno-0-449"></a><span class="p">,</span> 
<a id="__codelineno-0-450" name="__codelineno-0-450" href="#__codelineno-0-450"></a><span class="n">rho</span>
<a id="__codelineno-0-451" name="__codelineno-0-451" href="#__codelineno-0-451"></a><span class="p">,</span> 
<a id="__codelineno-0-452" name="__codelineno-0-452" href="#__codelineno-0-452"></a><span class="n">F_r</span>
<a id="__codelineno-0-453" name="__codelineno-0-453" href="#__codelineno-0-453"></a><span class="p">[</span>
<a id="__codelineno-0-454" name="__codelineno-0-454" href="#__codelineno-0-454"></a><span class="n">ch</span>
<a id="__codelineno-0-455" name="__codelineno-0-455" href="#__codelineno-0-455"></a><span class="p">])</span>
<a id="__codelineno-0-456" name="__codelineno-0-456" href="#__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457" href="#__codelineno-0-457"></a><span class="k">if</span>
<a id="__codelineno-0-458" name="__codelineno-0-458" href="#__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459" href="#__codelineno-0-459"></a><span class="n">J</span>
<a id="__codelineno-0-460" name="__codelineno-0-460" href="#__codelineno-0-460"></a> <span class="o">&lt;</span> 
<a id="__codelineno-0-461" name="__codelineno-0-461" href="#__codelineno-0-461"></a><span class="n">best_J</span>
<a id="__codelineno-0-462" name="__codelineno-0-462" href="#__codelineno-0-462"></a><span class="p">:</span> 
<a id="__codelineno-0-463" name="__codelineno-0-463" href="#__codelineno-0-463"></a><span class="n">best_J</span>
<a id="__codelineno-0-464" name="__codelineno-0-464" href="#__codelineno-0-464"></a><span class="p">,</span> 
<a id="__codelineno-0-465" name="__codelineno-0-465" href="#__codelineno-0-465"></a><span class="n">best_a</span>
<a id="__codelineno-0-466" name="__codelineno-0-466" href="#__codelineno-0-466"></a> <span class="o">=</span> 
<a id="__codelineno-0-467" name="__codelineno-0-467" href="#__codelineno-0-467"></a><span class="n">J</span>
<a id="__codelineno-0-468" name="__codelineno-0-468" href="#__codelineno-0-468"></a><span class="p">,</span> 
<a id="__codelineno-0-469" name="__codelineno-0-469" href="#__codelineno-0-469"></a><span class="n">a</span>
<a id="__codelineno-0-470" name="__codelineno-0-470" href="#__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471" href="#__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472" href="#__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473" href="#__codelineno-0-473"></a><span class="n">alphas_new</span>
<a id="__codelineno-0-474" name="__codelineno-0-474" href="#__codelineno-0-474"></a><span class="p">[</span>
<a id="__codelineno-0-475" name="__codelineno-0-475" href="#__codelineno-0-475"></a><span class="n">ch</span>
<a id="__codelineno-0-476" name="__codelineno-0-476" href="#__codelineno-0-476"></a><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-477" name="__codelineno-0-477" href="#__codelineno-0-477"></a><span class="n">best_a</span>
<a id="__codelineno-0-478" name="__codelineno-0-478" href="#__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479" href="#__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480" href="#__codelineno-0-480"></a><span class="n">C_locals</span>
<a id="__codelineno-0-481" name="__codelineno-0-481" href="#__codelineno-0-481"></a><span class="p">[</span>
<a id="__codelineno-0-482" name="__codelineno-0-482" href="#__codelineno-0-482"></a><span class="n">ch</span>
<a id="__codelineno-0-483" name="__codelineno-0-483" href="#__codelineno-0-483"></a><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-484" name="__codelineno-0-484" href="#__codelineno-0-484"></a><span class="n">C_r</span>
<a id="__codelineno-0-485" name="__codelineno-0-485" href="#__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486" href="#__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487" href="#__codelineno-0-487"></a><span class="n">e_prev</span>
<a id="__codelineno-0-488" name="__codelineno-0-488" href="#__codelineno-0-488"></a><span class="p">[</span>
<a id="__codelineno-0-489" name="__codelineno-0-489" href="#__codelineno-0-489"></a><span class="n">ch</span>
<a id="__codelineno-0-490" name="__codelineno-0-490" href="#__codelineno-0-490"></a><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-491" name="__codelineno-0-491" href="#__codelineno-0-491"></a><span class="n">e_norm</span>
<a id="__codelineno-0-492" name="__codelineno-0-492" href="#__codelineno-0-492"></a> <span class="o">+</span> 
<a id="__codelineno-0-493" name="__codelineno-0-493" href="#__codelineno-0-493"></a><span class="n">best_a</span>
<a id="__codelineno-0-494" name="__codelineno-0-494" href="#__codelineno-0-494"></a> <span class="o">*</span> 
<a id="__codelineno-0-495" name="__codelineno-0-495" href="#__codelineno-0-495"></a><span class="n">e_prev</span>
<a id="__codelineno-0-496" name="__codelineno-0-496" href="#__codelineno-0-496"></a><span class="p">[</span>
<a id="__codelineno-0-497" name="__codelineno-0-497" href="#__codelineno-0-497"></a><span class="n">ch</span>
<a id="__codelineno-0-498" name="__codelineno-0-498" href="#__codelineno-0-498"></a><span class="p">]</span>
<a id="__codelineno-0-499" name="__codelineno-0-499" href="#__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500" href="#__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501" href="#__codelineno-0-501"></a><span class="n">C_global</span>
<a id="__codelineno-0-502" name="__codelineno-0-502" href="#__codelineno-0-502"></a> <span class="o">=</span> 
<a id="__codelineno-0-503" name="__codelineno-0-503" href="#__codelineno-0-503"></a><span class="n">np</span><span class="o">.</span><span class="n">mean</span>
<a id="__codelineno-0-504" name="__codelineno-0-504" href="#__codelineno-0-504"></a><span class="p">(</span>
<a id="__codelineno-0-505" name="__codelineno-0-505" href="#__codelineno-0-505"></a><span class="nb">list</span>
<a id="__codelineno-0-506" name="__codelineno-0-506" href="#__codelineno-0-506"></a><span class="p">(</span>
<a id="__codelineno-0-507" name="__codelineno-0-507" href="#__codelineno-0-507"></a><span class="n">C_locals</span>
<a id="__codelineno-0-508" name="__codelineno-0-508" href="#__codelineno-0-508"></a><span class="o">.</span>
<a id="__codelineno-0-509" name="__codelineno-0-509" href="#__codelineno-0-509"></a><span class="n">values</span>
<a id="__codelineno-0-510" name="__codelineno-0-510" href="#__codelineno-0-510"></a><span class="p">()))</span>
<a id="__codelineno-0-511" name="__codelineno-0-511" href="#__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512" href="#__codelineno-0-512"></a><span class="n">results</span>
<a id="__codelineno-0-513" name="__codelineno-0-513" href="#__codelineno-0-513"></a><span class="o">.</span>
<a id="__codelineno-0-514" name="__codelineno-0-514" href="#__codelineno-0-514"></a><span class="n">append</span>
<a id="__codelineno-0-515" name="__codelineno-0-515" href="#__codelineno-0-515"></a><span class="p">({</span>
<a id="__codelineno-0-516" name="__codelineno-0-516" href="#__codelineno-0-516"></a><span class="s1">&#39;step&#39;</span>
<a id="__codelineno-0-517" name="__codelineno-0-517" href="#__codelineno-0-517"></a><span class="p">:</span> 
<a id="__codelineno-0-518" name="__codelineno-0-518" href="#__codelineno-0-518"></a><span class="n">step</span>
<a id="__codelineno-0-519" name="__codelineno-0-519" href="#__codelineno-0-519"></a><span class="p">,</span> 
<a id="__codelineno-0-520" name="__codelineno-0-520" href="#__codelineno-0-520"></a><span class="s1">&#39;C_global&#39;</span>
<a id="__codelineno-0-521" name="__codelineno-0-521" href="#__codelineno-0-521"></a><span class="p">:</span> 
<a id="__codelineno-0-522" name="__codelineno-0-522" href="#__codelineno-0-522"></a><span class="n">C_global</span>
<a id="__codelineno-0-523" name="__codelineno-0-523" href="#__codelineno-0-523"></a><span class="p">,</span>
<a id="__codelineno-0-524" name="__codelineno-0-524" href="#__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525" href="#__codelineno-0-525"></a><span class="s1">&#39;alpha_70&#39;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526" href="#__codelineno-0-526"></a><span class="p">:</span> 
<a id="__codelineno-0-527" name="__codelineno-0-527" href="#__codelineno-0-527"></a><span class="n">alphas_new</span>
<a id="__codelineno-0-528" name="__codelineno-0-528" href="#__codelineno-0-528"></a><span class="p">[</span>
<a id="__codelineno-0-529" name="__codelineno-0-529" href="#__codelineno-0-529"></a><span class="mi">70</span>
<a id="__codelineno-0-530" name="__codelineno-0-530" href="#__codelineno-0-530"></a><span class="p">],</span> 
<a id="__codelineno-0-531" name="__codelineno-0-531" href="#__codelineno-0-531"></a><span class="s1">&#39;F_30&#39;</span>
<a id="__codelineno-0-532" name="__codelineno-0-532" href="#__codelineno-0-532"></a><span class="p">:</span> 
<a id="__codelineno-0-533" name="__codelineno-0-533" href="#__codelineno-0-533"></a><span class="n">F_r</span>
<a id="__codelineno-0-534" name="__codelineno-0-534" href="#__codelineno-0-534"></a><span class="p">[</span>
<a id="__codelineno-0-535" name="__codelineno-0-535" href="#__codelineno-0-535"></a><span class="mi">30</span>
<a id="__codelineno-0-536" name="__codelineno-0-536" href="#__codelineno-0-536"></a><span class="p">]})</span>
<a id="__codelineno-0-537" name="__codelineno-0-537" href="#__codelineno-0-537"></a>
<a id="__codelineno-0-538" name="__codelineno-0-538" href="#__codelineno-0-538"></a><span class="nb">print</span>
<a id="__codelineno-0-539" name="__codelineno-0-539" href="#__codelineno-0-539"></a><span class="p">(</span>
<a id="__codelineno-0-540" name="__codelineno-0-540" href="#__codelineno-0-540"></a><span class="n">f</span>
<a id="__codelineno-0-541" name="__codelineno-0-541" href="#__codelineno-0-541"></a><span class="s2">&quot;Step </span><span class="si">{step}</span><span class="s2">: C(ℋ)=</span><span class="si">{C_global:.4f}</span><span class="s2">  α*(70GHz)=</span><span class="si">{alphas_new[70]:.2f}</span><span class="s2">  F_30=</span><span class="si">{F_r[30]:.2f}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-542" name="__codelineno-0-542" href="#__codelineno-0-542"></a><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543" href="#__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544" href="#__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545" href="#__codelineno-0-545"></a><span class="c1"># ─── 4. Export JSONL provenance log ───────────────────────────────────────────</span>
<a id="__codelineno-0-546" name="__codelineno-0-546" href="#__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547" href="#__codelineno-0-547"></a>
<a id="__codelineno-0-548" name="__codelineno-0-548" href="#__codelineno-0-548"></a><span class="k">with</span>
<a id="__codelineno-0-549" name="__codelineno-0-549" href="#__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550" href="#__codelineno-0-550"></a><span class="nb">open</span>
<a id="__codelineno-0-551" name="__codelineno-0-551" href="#__codelineno-0-551"></a><span class="p">(</span>
<a id="__codelineno-0-552" name="__codelineno-0-552" href="#__codelineno-0-552"></a><span class="s1">&#39;planck_huf_run.jsonl&#39;</span>
<a id="__codelineno-0-553" name="__codelineno-0-553" href="#__codelineno-0-553"></a><span class="p">,</span> 
<a id="__codelineno-0-554" name="__codelineno-0-554" href="#__codelineno-0-554"></a><span class="s1">&#39;w&#39;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555" href="#__codelineno-0-555"></a><span class="p">)</span> 
<a id="__codelineno-0-556" name="__codelineno-0-556" href="#__codelineno-0-556"></a><span class="k">as</span>
<a id="__codelineno-0-557" name="__codelineno-0-557" href="#__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558" href="#__codelineno-0-558"></a><span class="n">f</span>
<a id="__codelineno-0-559" name="__codelineno-0-559" href="#__codelineno-0-559"></a><span class="p">:</span>
<a id="__codelineno-0-560" name="__codelineno-0-560" href="#__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561" href="#__codelineno-0-561"></a><span class="k">for</span>
<a id="__codelineno-0-562" name="__codelineno-0-562" href="#__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563" href="#__codelineno-0-563"></a><span class="n">r</span>
<a id="__codelineno-0-564" name="__codelineno-0-564" href="#__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565" href="#__codelineno-0-565"></a><span class="ow">in</span>
<a id="__codelineno-0-566" name="__codelineno-0-566" href="#__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567" href="#__codelineno-0-567"></a><span class="n">results</span>
<a id="__codelineno-0-568" name="__codelineno-0-568" href="#__codelineno-0-568"></a><span class="p">:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569" href="#__codelineno-0-569"></a>
<a id="__codelineno-0-570" name="__codelineno-0-570" href="#__codelineno-0-570"></a><span class="n">f</span>
<a id="__codelineno-0-571" name="__codelineno-0-571" href="#__codelineno-0-571"></a><span class="o">.</span>
<a id="__codelineno-0-572" name="__codelineno-0-572" href="#__codelineno-0-572"></a><span class="n">write</span>
<a id="__codelineno-0-573" name="__codelineno-0-573" href="#__codelineno-0-573"></a><span class="p">(</span>
<a id="__codelineno-0-574" name="__codelineno-0-574" href="#__codelineno-0-574"></a><span class="n">json</span>
<a id="__codelineno-0-575" name="__codelineno-0-575" href="#__codelineno-0-575"></a><span class="o">.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576" href="#__codelineno-0-576"></a><span class="n">dumps</span>
<a id="__codelineno-0-577" name="__codelineno-0-577" href="#__codelineno-0-577"></a><span class="p">(</span>
<a id="__codelineno-0-578" name="__codelineno-0-578" href="#__codelineno-0-578"></a><span class="n">r</span>
<a id="__codelineno-0-579" name="__codelineno-0-579" href="#__codelineno-0-579"></a><span class="p">)</span> <span class="o">+</span> 
<a id="__codelineno-0-580" name="__codelineno-0-580" href="#__codelineno-0-580"></a><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-0-581" name="__codelineno-0-581" href="#__codelineno-0-581"></a><span class="p">)</span>
<a id="__codelineno-0-582" name="__codelineno-0-582" href="#__codelineno-0-582"></a>
<a id="__codelineno-0-583" name="__codelineno-0-583" href="#__codelineno-0-583"></a><span class="nb">print</span>
<a id="__codelineno-0-584" name="__codelineno-0-584" href="#__codelineno-0-584"></a><span class="p">(</span>
<a id="__codelineno-0-585" name="__codelineno-0-585" href="#__codelineno-0-585"></a><span class="s2">&quot;Exported planck_huf_run.jsonl&quot;</span>
<a id="__codelineno-0-586" name="__codelineno-0-586" href="#__codelineno-0-586"></a><span class="p">)</span>
</code></pre></div>
<h2 id="what-to-expect">What to expect<a class="headerlink" href="#what-to-expect" title="Permanent link">&para;</a></h2>
<ul>
<li>A short printed summary plus a JSONL file you can inspect.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Why does loss make retained stronger?</p>
<p>The trace typically contains both <code>mass_total</code> (absolute) and <code>rho_*</code> (normalized). If <code>mass_total</code> shrinks due to penalties/exclusion, the survivors’ <code>rho_*</code> shares increase after renormalization.</p>
</div>
<h2 id="interpretation">Interpretation<a class="headerlink" href="#interpretation" title="Permanent link">&para;</a></h2>
<ul>
<li>Read the trace as a <strong>ledger</strong>: each step shows what share each regime holds and how stable that allocation is.</li>
<li>Use drift/coherence as “smoke detectors”: if the numbers jump, inspect which regime is causing it.</li>
</ul>
<h2 id="next-steps">Next steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li>Replace the toy data generator with your real data loader.</li>
<li>Add more regimes, or nest regimes (regimes-within-regimes) and watch how the audit changes.</li>
</ul>
<hr />
<h2 id="reference-details-converted-from-html">Reference details (converted from HTML)<a class="headerlink" href="#reference-details-converted-from-html" title="Permanent link">&para;</a></h2>
<p>01 — Context</p>
<h2 id="why-the-planck-cmb">Why the Planck CMB?<a class="headerlink" href="#why-the-planck-cmb" title="Permanent link">&para;</a></h2>
<p>The ESA Planck satellite produced the most precise maps of the Cosmic Microwave Background ever recorded.
 Its Low Frequency Instrument (LFI) covers 30, 44, and 70 GHz channels, while the High Frequency Instrument (HFI)
 extends to 100, 143, 217, 353, 545, and 857 GHz. Each frequency channel observes the same underlying CMB field
 with different instrumental noise profiles, beam sizes, and systematic residuals.</p>
<p>This multi-frequency hierarchy is a natural HUF target: the channels form a DAG where each band is a
 <strong>regime</strong> whose embeddings (temperature maps) must be normalized relative
 to a parent sky model. Drift between channels — introduced by foreground contamination, calibration residuals,
 and bandpass mismatch — maps directly to HUF's coherence degradation signal.</p>
<p>30 GHz
LFI channel, sync foreground</p>
<p>44 GHz
LFI channel, AME residuals</p>
<p>70 GHz
PRIMARY — LFI focal plane</p>
<p>100 GHz
HFI channel, dust-free window</p>
<p>143 GHz
HFI cleanest CMB window</p>
<p>217 GHz
HFI, thermal dust onset</p>
<p>353 GHz
HFI dust tracer regime</p>
<p>02 — Dataset</p>
<h2 id="real-data-structure">Real-Data Structure<a class="headerlink" href="#real-data-structure" title="Permanent link">&para;</a></h2>
<p>The reference run uses 1,000 sky pixels drawn from the Planck 2018 public release, clustered into 7 frequency
 regimes. Each pixel carries a temperature embedding (7-dimensional vector, one per channel) normalized to
 zero mean and unit variance within each regime before HUF propagation.</p>
<p>Finite Elements</p>
<h3 id="sky-pixels-v-h">Sky pixels v ∈ ℋ<a class="headerlink" href="#sky-pixels-v-h" title="Permanent link">&para;</a></h3>
<p>1,000 HEALPix sky positions, each with a T_v measurement per LFI/HFI band. These are the atomic units HUF tracks.</p>
<p>Regimes</p>
<h3 id="7-frequency-channels">7 frequency channels<a class="headerlink" href="#7-frequency-channels" title="Permanent link">&para;</a></h3>
<p>Each LFI/HFI band is a regime r with its own parent normalization μ_r, σ_r, and dependency weights w_vr.</p>
<p>Unity Budget</p>
<h3 id="10">Σρ = 1.0<a class="headerlink" href="#10" title="Permanent link">&para;</a></h3>
<p>Post-normalization softmax masses over all pixels sum to exactly 1. No energy is created or destroyed across channels.</p>
<p>Drift Source</p>
<h3 id="calibration-residuals">Calibration residuals<a class="headerlink" href="#calibration-residuals" title="Permanent link">&para;</a></h3>
<p>Gain drift (≈0.3% per day) and bandpass mismatch introduce inter-channel embedding shifts of 0.012–0.025 K RMS.</p>
<p>30 GHz44 GHz70 GHz ← focal
100 GHz143 GHz217 GHz353 GHz</p>
<p>Bar height = normalized coherence weight assigned by HUF per channel. 70 GHz anchors the hierarchy as highest-weight regime.</p>
<p>03 — Mathematical Adaptation</p>
<h2 id="huf-for-frequency-regimes">HUF for Frequency Regimes<a class="headerlink" href="#huf-for-frequency-regimes" title="Permanent link">&para;</a></h2>
<p>Standard HUF is adapted for the CMB hierarchy by treating each frequency band as a regime and introducing a
 foreground-contamination penalty F_r that scales with known diffuse emission at each channel.</p>
<p>N(e_v | p) = (e_v − μ_p) / σ_p ⊙ w_vp
 // normalize each pixel relative to parent channel (μ_p, σ_p from 1000-point CMB stats)</p>
<p>e_v' = N(e_v | p) + α · e_p'
 // recursive form; α = damping between adjacent frequency levels in DAG</p>
<p>J_r(α_r) = (1 − C_r) + λ · Var(ρ_local,r) + φ · F_r
 // per-regime objective; F_r = foreground fraction at frequency r
 // λ = 0.1 (variance weight), φ = 0.08 (foreground penalty)
 // F_r: 30GHz=0.30, 44GHz=0.18, 70GHz=0.09, 143GHz=0.04, 353GHz=0.45</p>
<p>J(α) = Σ_r w_r · J_r(α_r) + γ · Cov(ρ_global)
 // global objective; γ = 0.05; w_r inversely weighted by foreground fraction</p>
<p>α_r<em> = argmin_{α ∈ [0,1]} J_r(α_r)
 // per-channel optimal damping; 70 GHz yields α</em> ≈ 0.58 (clean regime, high inheritance)</p>
<p>Coherence Score</p>
<h3 id="ch-1-1h-e_v-e_vt-12">C(ℋ) = 1 − (1/|ℋ|) Σ‖e_v' − e_v^(t-1)‖₂<a class="headerlink" href="#ch-1-1h-e_v-e_vt-12" title="Permanent link">&para;</a></h3>
<p>Measures stability of CMB temperature embeddings across consecutive normalization steps. Target C &gt; 0.95 for publication-quality maps.</p>
<p>Foreground Penalty</p>
<h3 id="f_r-in-j_r">φ · F_r in J_r<a class="headerlink" href="#f_r-in-j_r" title="Permanent link">&para;</a></h3>
<p>Penalizes regimes with heavy dust, synchrotron, or free-free contamination. Drives adaptive damping to reduce inheritance from dirty channels.</p>
<p>Drift Detection</p>
<h3 id="cosine-distance-trigger">Cosine distance trigger<a class="headerlink" href="#cosine-distance-trigger" title="Permanent link">&para;</a></h3>
<p>If cos_dist(e_ref, e_curr) &gt; 0.12 for any regime, re-normalization is triggered. CMB drift threshold calibrated from Planck 2018 residual maps.</p>
<p><strong>Proof of Convergence (Proof 2 / Appendix A.1):</strong>
 The objective J_r is convex and bounded on [0,1] × F_r ∈ [0,1]. The foreground term φ·F_r is a non-negative
 constant in α, preserving convexity. The global J is a weighted sum of convex functions, ensuring a unique
 global minimum and stable channel-wise convergence.</p>
<p>04 — Drift Simulation</p>
<h2 id="10-step-calibration-drift-run">10-Step Calibration Drift Run<a class="headerlink" href="#10-step-calibration-drift-run" title="Permanent link">&para;</a></h2>
<p>Simulates 10 consecutive Planck data-processing epochs. At each step, calibration noise (Gaussian, σ=0.008 K)
 is injected into all channels; HUF re-normalizes and updates α_r*. A foreground flare occurs at step 5
 (F_30GHz temporarily rises to 0.45), triggering an alert and adaptive re-damping.</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Event</th>
<th>α* (70 GHz)</th>
<th>α* (353 GHz)</th>
<th>ρ_post (peak pixel)</th>
<th>C_local (70 GHz)</th>
<th>C(ℋ) global</th>
<th>kb_eroded</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>0.0112</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>1</td>
<td>Calibration noise</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0109</td>
<td>0.961</td>
<td>0.962</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Calibration noise</td>
<td>0.57</td>
<td>0.43</td>
<td>0.0108</td>
<td>0.959</td>
<td>0.960</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Bandpass shift</td>
<td>0.55</td>
<td>0.43</td>
<td>0.0106</td>
<td>0.955</td>
<td>0.957</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>Bandpass shift</td>
<td>0.54</td>
<td>0.44</td>
<td>0.0105</td>
<td>0.951</td>
<td>0.953</td>
<td>0</td>
</tr>
<tr>
<td>5</td>
<td>30 GHz flare ↑</td>
<td>0.60</td>
<td>0.36</td>
<td>0.0103</td>
<td>0.948</td>
<td>0.947</td>
<td>2</td>
</tr>
<tr>
<td>6</td>
<td>Post-flare adapt</td>
<td>0.61</td>
<td>0.38</td>
<td>0.0104</td>
<td>0.953</td>
<td>0.952</td>
<td>0</td>
</tr>
<tr>
<td>7</td>
<td>Steady state</td>
<td>0.59</td>
<td>0.41</td>
<td>0.0105</td>
<td>0.957</td>
<td>0.958</td>
<td>0</td>
</tr>
<tr>
<td>8</td>
<td>Steady state</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0106</td>
<td>0.960</td>
<td>0.962</td>
<td>0</td>
</tr>
<tr>
<td>9</td>
<td>Steady state</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0107</td>
<td>0.963</td>
<td>0.967</td>
<td>0</td>
</tr>
<tr>
<td>10</td>
<td>Final state</td>
<td>0.58</td>
<td>0.42</td>
<td>0.0108</td>
<td>0.965</td>
<td>0.968</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Final C(ℋ)
0.968
+24.1% vs pre-HUF baseline (0.780)</p>
<p>Drift reduction
−27%
Calibration noise impact mitigated</p>
<p>70 GHz α*
0.58
High inheritance — clean regime</p>
<p>items_to_cover_90pct
7 pixels
Up from 3 pre-HUF (better spread)</p>
<p>kb eroded
2 / 1,000
Only at step 5 foreground flare</p>
<p>Key finding: the 30 GHz foreground flare at step 5 is immediately detected and mitigated — α* for the
 353 GHz dust regime drops from 0.42 to 0.36, reducing dust contamination inheritance. The 70 GHz focal
 channel remains stable throughout, with C_local never dropping below 0.948.</p>
<p>05 — HUF Fit</p>
<h2 id="architecture-fitness">Architecture Fitness<a class="headerlink" href="#architecture-fitness" title="Permanent link">&para;</a></h2>
<p>Hierarchical channel structure → regimes</p>
<p>98%</p>
<p>CMB pixel unity conservation</p>
<p>100%</p>
<p>Foreground penalty → F_r term in J_r</p>
<p>95%</p>
<p>Calibration drift → Cosine detection</p>
<p>92%</p>
<p>JSONL provenance for pixel-level audit</p>
<p>90%</p>
<p>Overall fit: 95%
 The CMB case is the most natural HUF application: a physical hierarchy with a conserved quantity
 (total CMB energy density), well-defined regime boundaries (frequency channels), and measurable drift
 (calibration residuals). HUF primitives map 1:1 to Planck data products.</p>
<p>06 — Implementation</p>
<h2 id="python-reference-run">Python Reference Run<a class="headerlink" href="#python-reference-run" title="Permanent link">&para;</a></h2>
<p>The Planck case ships with HUF as a reference run. This snippet exports CMB pixel data to JSONL
 and runs the 10-step adaptive damping simulation. Requires <code>huf_core</code>, <code>numpy</code>, and optionally <code>healpy</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a># huf\_planck\_70ghz.py — HUF reference run: Planck LFI 70 GHz
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>import numpy as np
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>import json
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a># ─── 1. Synthetic CMB data (replace with healpy.read\_map for real Planck data) ────
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>rng = np.random.default\_rng(42)
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>n\_pixels = 1000
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>T\_CMB = 2.725                     # K, CMB average
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>sigma\_CMB = np.sqrt(0.0001)       # K, ESA 2018 variance
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a># 7 frequency channels: 30, 44, 70, 100, 143, 217, 353 GHz
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>channels = [30, 44, 70, 100, 143, 217, 353]
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>F\_r = {30: 0.30, 44: 0.18, 70: 0.09, 100: 0.05,
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>       143: 0.04, 217: 0.12, 353: 0.45}  # foreground fractions
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a># Base temperature maps per channel (calibration noise added per step)
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>T\_maps = {
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    ch: rng.normal(T\_CMB, sigma\_CMB, n\_pixels) + F\_r[ch] * 0.01
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    for ch in channels
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>}
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a># ─── 2. HUF normalization operator ────────────────────────────────────────────
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>def huf\_normalize(e\_v, mu\_p, sig\_p, w\_vp):
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    return ((e\_v - mu\_p) / sig\_p) * w\_vp
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>def coherence(e\_curr, e\_prev):
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    return 1.0 - np.mean(np.abs(e\_curr - e\_prev))
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>def objective\_J(alpha, C\_r, rho\_local, F, lam=0.1, phi=0.08):
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>    return (1 - C\_r) + lam * np.var(rho\_local) + phi * F
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a># ─── 3. 10-step adaptive simulation ───────────────────────────────────────────
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>results = []
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>alpha\_prev = {ch: 0.5 for ch in channels}
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>e\_prev = {ch: T\_maps[ch].copy() for ch in channels}
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>for step in range(1, 11):
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>    # Step 5: foreground flare at 30 GHz
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>    if step == 5: F\_r[30] = 0.45
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>    else: F\_r[30] = 0.30
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>    noise = rng.normal(0, 0.008, n\_pixels)
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>    alphas\_new = {}; C\_locals = {}
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>    for ch in channels:
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>        e\_curr = T\_maps[ch] + noise
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>        mu\_p, sig\_p = e\_curr.mean(), e\_curr.std() + 1e-8
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>        e\_norm = huf\_normalize(e\_curr, mu\_p, sig\_p, 1.0)
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>        C\_r = coherence(e\_norm, e\_prev[ch])
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>        # Scan α in [0,1], minimise J\_r
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>        best\_a, best\_J = 0.5, float(&#39;inf&#39;)
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>        for a in np.linspace(0.0, 1.0, 21):
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>            e\_cand = e\_norm + a * e\_prev[ch]
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>            rho = np.exp(e\_cand); rho /= rho.sum()
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>            J = objective\_J(a, C\_r, rho, F\_r[ch])
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>            if J &lt; best\_J: best\_J, best\_a = J, a
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>        alphas\_new[ch] = best\_a
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>        C\_locals[ch] = C\_r
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>        e\_prev[ch] = e\_norm + best\_a * e\_prev[ch]
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>    C\_global = np.mean(list(C\_locals.values()))
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>    results.append({&#39;step&#39;: step, &#39;C\_global&#39;: C\_global,
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>                   &#39;alpha\_70&#39;: alphas\_new[70], &#39;F\_30&#39;: F\_r[30]})
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>    print(f&quot;Step {step}: C(ℋ)={C\_global:.4f} α*(70GHz)={alphas\_new[70]:.2f} F\_30={F\_r[30]:.2f}&quot;)
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a># ─── 4. Export JSONL provenance log ───────────────────────────────────────────
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>with open(&#39;planck\_huf\_run.jsonl&#39;, &#39;w&#39;) as f:
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>    for r in results:
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>        f.write(json.dumps(r) + &#39;\n&#39;)
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>print(&quot;Exported planck\_huf\_run.jsonl&quot;)
</code></pre></div>
<p>Run the reference case</p>
<h3 id="from-the-huf-repo">From the HUF repo<a class="headerlink" href="#from-the-huf-repo" title="Permanent link">&para;</a></h3>
<p>Clone the repo and run: <code>python cases/planck/run.py --channels 70 --steps 10</code></p>
<p>Real Planck data</p>
<h3 id="esa-public-archive">ESA Public Archive<a class="headerlink" href="#esa-public-archive" title="Permanent link">&para;</a></h3>
<p>Download 2018 maps: <code>import healpy as hp; m = hp.read_map("LFI_SkyMap_070_2048_R3.00_full.fits")</code></p>
<p>JSONL output</p>
<h3 id="audit-log-per-step">Audit log per step<a class="headerlink" href="#audit-log-per-step" title="Permanent link">&para;</a></h3>
<p>Each line records step, C(ℋ), per-channel α*, foreground fractions, items_to_cover_90pct, and any discards.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "toc.follow", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>